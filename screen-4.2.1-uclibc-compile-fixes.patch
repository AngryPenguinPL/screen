From 8846747c838be6184f90f58059f2ade99b491650 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Per=20=C3=98yvind=20Karlsen=20=28proyvind=29?=
 <proyvind@moondrake.org>
Date: Tue, 20 May 2014 00:51:55 +0000
Subject: [PATCH] uclibc fixes..

---
 Makefile      |  2 +-
 Makefile.in   |  2 +-
 extern.h      |  2 ++
 sched.h       | 48 ------------------------------------------------
 sched_local.h | 53 +++++++++++++++++++++++++++++++++++++++++++++++++++++
 screen.h      |  2 +-
 6 files changed, 58 insertions(+), 50 deletions(-)
 delete mode 100644 sched.h
 create mode 100644 sched_local.h

diff --git a/Makefile b/Makefile
index 561049b..8903b19 100644
--- a/Makefile
+++ b/Makefile
@@ -188,7 +188,7 @@ $(SCREEN).tar: .version term.h comm.h tty.c kmapdef.c
 	ln acls.h ansi.h display.h extern.h logfile.h mark.h os.h \
 	   layer.h patchlevel.h screen.h window.h image.h \
 	   osdef.h.in term.sh tty.sh comm.sh osdef.sh braille.h \
-	   sched.h \
+	   sched_local.h \
 	   $(CFILES) \
 	   ChangeLog COPYING INSTALL NEWS* TODO install.sh \
 	   dist/$(SCREEN)
diff --git a/Makefile.in b/Makefile.in
index 187a69b..367e68a 100644
--- a/Makefile.in
+++ b/Makefile.in
@@ -188,7 +188,7 @@ $(SCREEN).tar: .version term.h comm.h tty.c kmapdef.c
 	ln acls.h ansi.h display.h extern.h logfile.h mark.h os.h \
 	   layer.h patchlevel.h screen.h window.h image.h \
 	   osdef.h.in term.sh tty.sh comm.sh osdef.sh braille.h \
-	   sched.h \
+	   sched_local.h \
 	   $(CFILES) \
 	   ChangeLog COPYING INSTALL NEWS* TODO install.sh \
 	   dist/$(SCREEN)
diff --git a/extern.h b/extern.h
index 8690821..7617e8c 100644
--- a/extern.h
+++ b/extern.h
@@ -161,8 +161,10 @@ extern void  CloseDevice __P((struct win *));
 extern void  zmodem_abort __P((struct win *, struct display *));
 #endif
 #ifndef HAVE_EXECVPE
+#ifndef __UCLIBC__
 extern void  execvpe __P((char *, char **, char **));
 #endif
+#endif
 
 /* utmp.c */
 #ifdef UTMPOK
diff --git a/sched.h b/sched.h
deleted file mode 100644
index fdc3fc4..0000000
--- a/sched.h
+++ /dev/null
@@ -1,48 +0,0 @@
-/* Copyright (c) 2008, 2009
- *      Juergen Weigert (jnweiger@immd4.informatik.uni-erlangen.de)
- *      Michael Schroeder (mlschroe@immd4.informatik.uni-erlangen.de)
- *      Micah Cowan (micah@cowan.name)
- *      Sadrul Habib Chowdhury (sadrul@users.sourceforge.net)
- * Copyright (c) 1993-2002, 2003, 2005, 2006, 2007
- *      Juergen Weigert (jnweiger@immd4.informatik.uni-erlangen.de)
- *      Michael Schroeder (mlschroe@immd4.informatik.uni-erlangen.de)
- * Copyright (c) 1987 Oliver Laumann
- *
- * This program is free software; you can redistribute it and/or modify
- * it under the terms of the GNU General Public License as published by
- * the Free Software Foundation; either version 3, or (at your option)
- * any later version.
- *
- * This program is distributed in the hope that it will be useful,
- * but WITHOUT ANY WARRANTY; without even the implied warranty of
- * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
- * GNU General Public License for more details.
- *
- * You should have received a copy of the GNU General Public License
- * along with this program (see the file COPYING); if not, see
- * http://www.gnu.org/licenses/, or contact Free Software Foundation, Inc.,
- * 51 Franklin Street, Fifth Floor, Boston, MA  02111-1301  USA
- *
- ****************************************************************
- * $Id$ GNU
- */
-
-struct event
-{
-  struct event *next;
-  void (*handler) __P((struct event *, char *));
-  char *data;
-  int fd;
-  int type;
-  int pri;
-  struct timeval timeout;
-  int queued;		/* in evs queue */
-  int active;		/* in fdset */
-  int *condpos;		/* only active if condpos - condneg > 0 */
-  int *condneg;
-};
-
-#define EV_TIMEOUT	0
-#define EV_READ		1
-#define EV_WRITE	2
-#define EV_ALWAYS	3
diff --git a/sched_local.h b/sched_local.h
new file mode 100644
index 0000000..f1c29f8
--- /dev/null
+++ b/sched_local.h
@@ -0,0 +1,53 @@
+#ifndef __SCHED_H
+#define __SCHED_H
+/* Copyright (c) 2008, 2009
+ *      Juergen Weigert (jnweiger@immd4.informatik.uni-erlangen.de)
+ *      Michael Schroeder (mlschroe@immd4.informatik.uni-erlangen.de)
+ *      Micah Cowan (micah@cowan.name)
+ *      Sadrul Habib Chowdhury (sadrul@users.sourceforge.net)
+ * Copyright (c) 1993-2002, 2003, 2005, 2006, 2007
+ *      Juergen Weigert (jnweiger@immd4.informatik.uni-erlangen.de)
+ *      Michael Schroeder (mlschroe@immd4.informatik.uni-erlangen.de)
+ * Copyright (c) 1987 Oliver Laumann
+ *
+ * This program is free software; you can redistribute it and/or modify
+ * it under the terms of the GNU General Public License as published by
+ * the Free Software Foundation; either version 3, or (at your option)
+ * any later version.
+ *
+ * This program is distributed in the hope that it will be useful,
+ * but WITHOUT ANY WARRANTY; without even the implied warranty of
+ * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
+ * GNU General Public License for more details.
+ *
+ * You should have received a copy of the GNU General Public License
+ * along with this program (see the file COPYING); if not, see
+ * http://www.gnu.org/licenses/, or contact Free Software Foundation, Inc.,
+ * 51 Franklin Street, Fifth Floor, Boston, MA  02111-1301  USA
+ *
+ ****************************************************************
+ * $Id$ GNU
+ */
+
+#include <sys/time.h>
+
+struct event
+{
+  struct event *next;
+  void (*handler) __P((struct event *, char *));
+  char *data;
+  int fd;
+  int type;
+  int pri;
+  struct timeval timeout;
+  int queued;		/* in evs queue */
+  int active;		/* in fdset */
+  int *condpos;		/* only active if condpos - condneg > 0 */
+  int *condneg;
+};
+
+#define EV_TIMEOUT	0
+#define EV_READ		1
+#define EV_WRITE	2
+#define EV_ALWAYS	3
+#endif
diff --git a/screen.h b/screen.h
index 603ca3f..4d6837a 100644
--- a/screen.h
+++ b/screen.h
@@ -43,7 +43,7 @@
 #include "osdef.h"
 
 #include "ansi.h"
-#include "sched.h"
+#include "sched_local.h"
 #include "acls.h"
 #include "comm.h"
 #include "layer.h"
-- 
1.9.0

